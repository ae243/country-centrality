\section{System Architecture}
\label{architecture}

In this section, we discuss ?? - a system for avoiding a specified country when accessing a webpage.

\subsection{Threat Model}
\label{threat}
This system is targeting an attacker who is at the nation-state level, and practices wiretapping on Internet traffic within the nation-state.  This type of attacker can appear on either the forward or reverse path, as shown in Figure~\ref{fig:attacker}. \annie{add two subfigures for attacker on forward and reverse path and describe each one}.  An attacker can also conduct surveillance on parts of webpages by being on the path from the client to some source that is requested by an initial page load; for example, a client accesses foo.com, and foo.com uses a Javascript file from bar.com, but bar.com is located in a different location.  An attacker can see the traffic between the client and bar.com, but not the client and foo.com.  This is depicted in Figure~\ref{fig:subdomain} \annie{add this figure}.

\subsection{Design Goals}

With the attacker described in Section~\ref{sec:threat} in mind, ?? has three goals: singular country avoidance, avoiding colluding countries, and usability.  

{\bf Country Avoidance.}  The system should allow an Internet user, a client, to access web content without having her traffic travel through a country that she specifies, particularly countries that conduct surveillance.  The specified country should be avoided on both the forward and reverse paths, as they have been shown to be asymmetric, and thus a country may be on the reverse path, but not on the forward path \annie{need citation here}.  

{\bf Colluding Countries.}  There have been agreements between countries to share surveillance data; this is analagous to colluding adversaries \annie{cite different pacts/agreements}.  This system will allow clients to specify multiple countries to avoid, and the system will attempt to avoid all specified countries.  For the purposes of simplicity, the examples and descriptions in this paper will include only one country to avoid, but the system will be designed to handle multiple colluding countries.

{\bf Usability.} [from both client and server sides.]  In order for the system to be used, it must be usable from both the client- and server-side.  All participants in the system must be required to do as little work as possible to use the system.  We envision the system growing, and our goals for that would also be scalability, load-balancing, performance, etc.

We assume that relays, clients, servers, and oracles are not malicious, and that no other attacks, such as Man-in-the-Middle, BGP prefix hijack, etc., are occuring.  

\subsection{Architecture Overview}

Figure~\ref{fig:overview} shows the steps that occur when a client visits www.foo.com, using a standard browser. \annie{Make this diagram.} Both the oracle and the server maintain country-level path information, which is described in more detail in Section~\ref{sec:maps}.

\begin{enumerate}
\item A client queries the oracle by supplying a domain and a country to avoid.  
\item The oracle searchs for a suitable relay, such that the specified country is not on the client to relay path, the relay to server path, and the relay to client path.  Once this relay is found, it responds to the client with the IP address of the relay.
\item The client sends the web request to the relay.
\item The relay forwards the request to the closest server that contains the domain.
\item The server determines if the server to relay path avoids the given country.  If so, then it sends the response to the relay. If not, then it will check if any of the geo-replicated servers have a path to the relay that does not include the given country; if there is such a path, then it uses it, otherwise, country avoidance is not possible for this request.
\item The relay forwards the response to the client.
\end{enumerate}

\subsubsection{Client} Describe what actions the client takes.

\subsubsection{Oracle} Describe what actions the oracle takes.

\subsubsection{Relay} Describe what actions the relays take.

\subsubsection{Server} Describe what actions the server takes.  Also discuss asymmetry study to justify why we care about the reverse path (and therefore server participation).

\subsection{Mapping Creation and Maintenance}
\label{maps}

\subsubsection{Oracle}

\subsubsection{Servers}

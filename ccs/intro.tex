\section{Introduction}
\label{intro}

When Internet traffic enters a country, it becomes subject to that
country's laws.  As a result, users have more need than ever to
determine---and control---which countries their traffic is traversing.
An increasing number of countries have passed laws that facilitate mass
surveillance of their networks~\cite{france_surveillance,
  netherlands_surveillance, kazak_surveillance, uk_bill}, and governments
and citizens are increasingly motivated to divert their Internet traffic
from countries that perform surveillance (notably, the United
States~\cite{russia_secure_internet,
  routing_errors, dte}).
% More recently, the Safe Harbor agreement,
%which allows the free flow of data between the US and the EU, 
%was struck down because it would give the NSA access to EU citizens'
%personal data~\cite{safe_harbour_illegal, safe_harbour_undecided}.  

Many countries---notably, Brazil---are taking impressive measures to reduce
the likelihood that Internet traffic transits the United
States~\cite{brazil_history, brazil_break_from_US, brazil_conference,
  brazil_conference2, brazil_human_rights} including building a 3,500-mile
 long fiber-optic cable from Fortaleza to Portugal (with no use of
American vendors); pressing companies such as Google, Facebook, and
Twitter (among others) to store data locally; and mandating the deployment of a state-developed email system (Expresso) throughout the federal government (instead of what was originally used, Microsoft Outlook)~\cite{brazil_cable, brazil_us_companies}.  Brazil is also
building Internet Exchange Points (IXPs)~\cite{brazil_IXP1}, now has the
largest national ecosystem of public IXPs in
the world~\cite{brazil_ixp_ecosystem}, and the number of internationally
connected ASes continues to
grow~\cite{brazil_international_ases}. Brazil is not alone: IXPs are
proliferating in eastern Europe, Africa, and other regions, in part out
of a desire to ``keep local traffic local''. Building IXPs alone, of
course, cannot guarantee that Internet traffic for some service does not
enter or transit a particular country: Internet protocols have no notion
of national borders, and interdomain paths depend in large part on
existing interconnection business relationships (or lack thereof). 

While encryption may hide urls and content, it cannot guarantee that surveillance 
states will not learn information about the client's traffic.  In fact, many websites do not fully support 
encrypted browsing by default; a recent study showed that more than 85\% of the most popular 
health, news, and shopping sites do not encrypt by default~\cite{what_isps_can_see}.  Additionally, migrating 
to HTTPS from HTTP is difficult because it requires all third-party domains on the site to also use 
HTTPS.  Even if more sites use HTTPS, information about a client's web browsing history and patterns 
can be revealed in multiple ways. One way is through DNS: DNS requests are almost never encrypted ~\cite{what_isps_can_see}, therefore 
ISPs can (and do) monitor the domains a client requests.  Another way is through side channels: by examining 
characteristics about the traffic (timing, size, and destination), one can determine unique web page visits.  
Yet another way to learn information about encrypted traffic is through website fingerprinting; features 
such as content size and the number, content, and location of third party resources requested can be used to 
identify a specific web page.  In addition, ISPs have been increasingly conducting Man-In-The-Middle attacks on 
encrypted traffic for various reasons, such as attempting to conserve bandwidth by blocking online video streaming~\cite{mitm_isp}.  
Based on the number and variety of ways that an adversary can identify a client's web request, \textit{even when it is encrypted}, 
shows that encrypted traffic is still susceptible to surveillance performed by foreign states.

Prior work explored a country's centrality to global routing based on 
inferred country-level paths~\cite{karlin2009nation}. 
In this paper, we study two questions: (1)~Which countries do {\em
  default} Internet routing paths traverse?; (2)~What types of methods
can we use to take advantage of hosting and path diversity to help governments
and citizens better control transnational Internet paths? 
In contrast to previous work~\cite{karlin2009nation}, which simulates paths, we \textit{actively} measure and analyze the traffic originating in
five different countries: Brazil, Netherlands, Kenya, India, and the
United States.  We study these countries for different reasons, including their efforts made to avoid certain countries, efforts in building out IXPs, and their low cost of hosting domains.  Our work studies the router-level forwarding path, which differs from 
 previous work, which has analyzed Border Gateway Protocol (BGP) routes~\cite{karlin2009nation,shah2015characterizing}.  
BGP routes are Autonomous System (AS)-level paths, whereas the paths we collect and analyze are IP- and country-level paths.

Determining where a client's Internet traffic flows is challenging due to the
 complexity of websites~\cite{butkiewicz2011understanding}.  Many
websites embed content from other domains, which are most likely
hosted in different locations.  Therefore, the client has to make
additional web requests, which take different paths to different servers.  One initial web
request can result in content being fetched from many servers located
around the world, and to see where this traffic flows requires knowledge
of all paths from the client to requested servers (and all the requested
servers to the client).  We measure traffic routes by using RIPE 
Atlas probes in the five countries we studied and running traceroutes to 
the Alexa Top 100 domains for each country.  Therefore, our traceroute measurements include the 
set of domains and third party domains as destinations.  After mapping 
traceroutes to country-level paths, we analyze which 
countries host and/or transit the traffic.

To measure how avoidable a given country is, we study two existing tools: open DNS resolvers 
and overlay network relays. For
example, a client can query an open DNS resolver in a foreign country to
discover a different georeplicated instance of a service; this technique
(or the use of EDNS client subnet) can allow the client to discover
different replicas of the same service. The path to this newly
discovered replica may assist in avoiding particular countries
(particularly if the client is trying to avoid the country of the
original hosting replica!).  On the other hand, the increasing use of IP anycast \cite{cicalese2015characterizing} can
sometimes make this technique insufficient if the client
receives the same IP address regardless of the apparent origin of the
DNS query.  Another approach involves using overlay network relays, which can
prevent the client from traversing an unfavorable country by introducing
a path that detours from the default. Additionally, using
relays in the client's country can sometimes help keep local traffic
local, by exploiting local paths that BGP does not select by default.

To evaluate the use of open resolvers as a tool for country avoidance, we
query open resolvers in geographically diverse locations around the world.  Then we traceroute 
to the IP addresses in the DNS responses, and map the traceroutes to country-level paths.  To evaluate 
overlay network relays for country-avoidance, we establish 12 relays in geographically 
diverse locations around the world, run traceroutes from the country of interest to 
each relay, as well as from each relay to each domain (website).  After mapping 
the traceroutes to country-level paths, we measure which countries are 
avoidable.

The following highlights our results on hosting diversity, routing diversity, and avoidance feasibility.

\paragraph{Hosting diversity.} We start by looking at hosting diversity, more specifically, how many
countries a domain is hosted in.  More diversity should provide for the
potential to avoid more countries.  About half of the
Alexa Top 100 domains in the five countries studied are hosted in more
than one country. 

\paragraph{Routing diversity.} Despite strong efforts made by some countries to ensure their traffic does 
not transit unfavorable countries~\cite{brazil_history, brazil_break_from_US, brazil_conference,
  brazil_conference2, brazil_human_rights},
their traffic still traverses surveillance states.  Over 50\% of the top domains in
Brazil and India are hosted in the United States, and over 50\% of the
paths from the Netherlands to the top domains transit the
United States.  About half of Kenyan traffic to the top domains traverses the United States
and Great Britain (but the same half does not traverse both countries).  Much of this phenomenon is
due to ``tromboning,'' whereby an Internet path starts and ends in a
country, yet transits an intermediate country; for example, about 13\%
of the paths that we explored from Brazil tromboned through the United States. 

\paragraph{Avoidance Feasibility.} We find that the two techniques---using the open DNS resolver 
infrastructure and using overlay network relays---give clients the power to avoid unfavorable countries.  Without these
country avoidance techniques, Brazilian traffic transitted Spain, Italy,
France, Great Britain, Argentina, Ireland (among others), but using the
overlay network, Brazilian clients could completely avoid these
countries.  Relays can be used to
keep local traffic local; by using relays in the client's country, less
traffic trombones out of the client's country.  The percentage of tromboning paths
from the United States decreases from 11.2\% to 1.3\% when
relays are used.   

\paragraph{Cause for concern.} Unfortunately, some of the more prominent surveillance states are also
some of the least avoidable countries.  Most countries are
highly dependent on the United States, a known surveillance state, and
not dependent on other countries.  Neither Brazil, India, Kenya, nor the
Netherlands can completely avoid the United States with the country
avoidance techniques.  With the overlay network, both Brazilian and
Netherlands paths avoid the United States about 65\% of the time, but
the United States is completely unavoidable for about 10\% of the paths
because it is the only country where the content is hosted.  Kenyan traffic can
only avoid the United States on about 40\% of the paths from Kenya.  On the other hand, the United States can avoid
every other country except for France and the Netherlands, and even then
they are avoidable for 99\% of the top domains. 

We find that current traffic is traversing known surveillance states, but tools can help us achieve country avoidance. Our contributions 
include: 

\begin{itemize}
\item The first in-depth measurement study of
  transnational routing detours for Brazil, Netherlands, Kenya, India, and the
  United States. 
\item An evaluation of how open DNS resolvers and overlay
  network relays can help clients discover and use
  network paths that avoid certain countries.
\end{itemize}
\noindent

This rest of this paper is organized as follows.  In the next section, we discuss
the current nation-states that conduct mass surveillance or are in the 
process of drafting laws for surveillance.  In
Section~\ref{datasets} we characterize transnational routing detours. Next, Section
\ref{avoid_results} shows how we can prevent transnational routing detours by using open DNS resolvers
and overlay network relays.  We discuss further ideas in Section
\ref{discussion}, we review related work in Section \ref{related}, and
conclude in Section \ref{conclusion}. 
